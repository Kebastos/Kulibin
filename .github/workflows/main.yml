name: Main

on:
  push:
    branches:
      - '*'
    tags:
      - '*'

env:
  java_version: 17

jobs:
  get-tag:
    uses: ./.github/workflows/get-tag.yml

  lint:
    uses: ./.github/workflows/lint.yml
    with:
      java-version: ${{ java_version }}

  build:
    uses: ./.github/workflows/build.yml
    needs: [get-tag, lint]
    with:
      java-version: ${{ java_version }}
      tag-name: ${{ needs.get-tag.outputs.tag-name }}

  release:
    uses: ./.github/workflows/release.yml
    needs: [get-tag, build]
    with:
      java-version: ${{ java_version }}
      tag-name: ${{ needs.get-tag.outputs.tag-name }}
      is-prerelease: ${{ github.ref != 'refs/heads/main' }}